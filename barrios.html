<!DOCTYPE html>
<html>
<head>
    <title>Mapa Interactivo de Barrios de Jesús María</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f9fa;
        }
        #mapa { 
            height: 100vh;
            width: 100%;
            background-color: #ffffff;
        }
        /* Estilo para el tooltip que aparece al pasar el mouse */
        .leaflet-tooltip-own {
            background-color: rgba(0, 0, 0, 0.75);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

    <div id="mapa"></div>

    <script>
        // --- 1. CONFIGURACIÓN INICIAL DEL MAPA ---
        // Centramos el mapa en una ubicación aproximada de Jesús María, Córdoba.
        var mapa = L.map('mapa').setView([-31.07, -64.09], 14);
        
        // Se mantiene el fondo de mapa claro y minimalista de CartoDB.
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            attribution: 'Datos &copy; OpenStreetMap | Tiles &copy; CartoDB',
            maxZoom: 19
        }).addTo(mapa);


        // --- 2. ASIGNACIÓN DE COLORES Y ESTILOS ---

        // Función para generar colores únicos y distinguibles usando el "ángulo dorado".
        // Esto asegura que los colores sucesivos estén lo más separados posible en el espectro.
        // Referencia: https://martin.ankerl.com/2009/12/09/how-to-create-random-colors-programmatically/
        let h = Math.random(); // Empezar con un matiz aleatorio.
        const golden_ratio_conjugate = 0.61803398875;
        function obtenerColorUnico() {
            h += golden_ratio_conjugate;
            h %= 1;
            const hue = h * 360;
            // Usamos una saturación y luminosidad fijas para colores vibrantes pero no demasiado brillantes.
            return `hsl(${hue}, 75%, 55%)`; 
        }

        // Estilo base para los polígonos de los barrios.
        function estiloBase(feature) {
            // Asignamos un color único a cada feature cuando se carga por primera vez.
            if (!feature.properties.colorAsignado) {
                feature.properties.colorAsignado = obtenerColorUnico();
            }
            return {
                fillColor: feature.properties.colorAsignado,
                fillOpacity: 0.75,
                weight: 1.5, // Grosor del borde
                color: 'white', // Color del borde
                opacity: 1
            };
        }
        
        // Estilo para resaltar el polígono cuando el mouse pasa por encima.
        const estiloResaltado = {
            weight: 4,
            color: '#333',
            fillOpacity: 0.9
        };

        // --- 3. MANEJO DE INTERACTIVIDAD ---
        let geojsonLayer; // Variable para guardar la capa y poder acceder a ella.

        function resaltarFeature(e) {
            var layer = e.target;
            layer.setStyle(estiloResaltado);

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
            
            // Muestra el nombre del barrio en un tooltip
            layer.bindTooltip(layer.feature.properties.nombre, {
                permanent: false, 
                direction: 'center', 
                className: 'leaflet-tooltip-own'
            }).openTooltip();
        }

        function resetearResaltado(e) {
            geojsonLayer.resetStyle(e.target);
            e.target.closeTooltip();
        }

        function hacerClickEnFeature(e) {
            // Muestra un popup con el nombre del barrio al hacer clic.
            var layer = e.target;
            var nombreBarrio = layer.feature.properties.nombre || "Nombre no disponible";
            L.popup()
                .setLatLng(e.latlng)
                .setContent('<h4 style="margin:0; padding:0;">Barrio:</h4><b style="font-size: 1.2em;">' + nombreBarrio + '</b>')
                .openOn(mapa);
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: resaltarFeature,
                mouseout: resetearResaltado,
                click: hacerClickEnFeature
            });
        }

        // --- 4. CARGA DE DATOS GEOJSON ---
        const geojsonURL = "https://raw.githack.com/gisjesusmaria/web/main/barrios.geojson";

        fetch(geojsonURL)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Error al cargar los datos: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                geojsonLayer = L.geoJson(data, {
                    style: estiloBase,
                    onEachFeature: onEachFeature
                }).addTo(mapa);
                
                // Ajusta el zoom del mapa para que todos los barrios sean visibles.
                if (geojsonLayer.getBounds().isValid()) {
                    mapa.fitBounds(geojsonLayer.getBounds());
                }
            })
            .catch(error => {
                console.error("Hubo un error al cargar el GeoJSON:", error);
                alert("ERROR: No se pudo cargar la capa de barrios. Revisa la consola (F12) para más detalles.");
            });

    </script>
</body>
</html>


