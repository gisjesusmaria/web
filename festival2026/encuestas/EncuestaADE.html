<!-- 09012026_2138 -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Relevamiento a comercios - Operativo Festival 2026</title>

  <!-- Favicon -->
  <link rel="icon" href="https://raw.githubusercontent.com/gisjesusmaria/web/refs/heads/main/favicon.ico" />

<style>
  :root{
    --bg: #eef5fb;
    --card: #ffffff;
    --card2: #f8fbff;
    --text: #0f172a;
    --muted: #475569;
    --line: #dbeafe;
    --accent: #1d4ed8;   /* azul */
    --accent2:#f97316;   /* naranja */
    --danger:#dc2626;
    --ok:#16a34a;
    --shadow: 0 12px 30px rgba(15,23,42,.12);
    --radius: 16px;
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background:
      radial-gradient(900px 500px at 10% 0%, #dbeafe, transparent 60%),
      radial-gradient(900px 600px at 90% 10%, #ffedd5, transparent 55%),
      var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 28px 16px 60px;
  }

  .wrap{max-width: 940px;margin:0 auto}

  .top{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    flex-wrap:wrap;
    margin-bottom: 18px;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:14px;
  }

  .logo{
    height:56px;
    width:auto;
    border-radius:10px;
    background:#fff;
    padding:4px;
    box-shadow: 0 6px 16px rgba(0,0,0,.12);
  }

  .titles h1{
    font-size: 22px;
    margin:0 0 4px 0;
    color: var(--accent);
  }

  .titles p{
    margin:0;
    color: var(--muted);
    font-size:14px;
  }

  .card{
    background: linear-gradient(180deg, var(--card), var(--card2));
    border: 1px solid var(--line);
    box-shadow: var(--shadow);
    border-radius: var(--radius);
    overflow:hidden;
  }

  .card-header{
    padding: 18px;
    border-bottom:1px solid var(--line);
    background:#f0f6ff;
  }

  .chip{
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid var(--line);
    color: var(--accent);
    background:#e0ecff;
    white-space:nowrap;
  }

  form{padding: 18px}

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }

  @media (max-width: 820px){
    .grid{grid-template-columns: 1fr}
    .logo{height:48px}
  }

  .field{
    padding: 14px;
    border: 1px solid var(--line);
    border-radius: 14px;
    background: #ffffff;
  }

  .field label{
    display:flex;
    align-items:center;
    gap:6px;
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 8px;
    color:#0f172a;
  }

  .req{
    color: var(--danger);
    font-weight: 800;
  }

  .hint{
    margin-top: 6px;
    color: var(--muted);
    font-size: 12.5px;
    line-height: 1.35;
  }

  input[type="text"],
  input[type="number"],
  textarea,
  select{
    width:100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid #c7d2fe;
    background: #ffffff;
    color: var(--text);
    outline: none;
  }

  input:focus,
  textarea:focus,
  select:focus{
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(29,78,216,.15);
  }

  textarea{min-height: 110px; resize: vertical}

  .inline{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center
  }

  .radio{
    display:flex;
    align-items:center;
    gap:10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid #c7d2fe;
    background: #f8fafc;
    cursor:pointer;
    user-select:none;
  }

  .radio input{accent-color: var(--accent)}

  .actions{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    justify-content:flex-end;
    padding: 16px 18px;
    border-top:1px solid var(--line);
    background:#f8fafc;
  }

  button{
    border:0;
    padding: 11px 16px;
    border-radius: 14px;
    cursor:pointer;
    font-weight: 700;
    color: #ffffff;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow: 0 10px 22px rgba(0,0,0,.18);
  }

  button:hover{opacity:.95}

  button:disabled{
    opacity:.6;
    cursor:not-allowed
  }

  .secondary{
    background: #ffffff;
    color: var(--accent);
    border:1px solid var(--accent);
    box-shadow:none;
  }

  .status{
    padding: 12px 18px 0;
    color: var(--muted);
    font-size: 13px;
  }

  .toast{
    margin-top: 10px;
    padding: 12px 14px;
    border-radius: 14px;
    border:1px solid var(--line);
    background: #ffffff;
    display:none;
  }

  .toast.ok{
    border-color: #86efac;
    background:#f0fdf4;
  }

  .toast.err{
    border-color: #fecaca;
    background:#fef2f2;
  }

    /* OVERLAY submit (spinner + éxito) */
    .overlay.hidden{ display:none; }
    .overlay{
    position: fixed;
    inset: 0;
    background: rgba(17,24,39,0.55);
    backdrop-filter: blur(4px);
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 18px;
    z-index: 9999;
    }

    .overlayCard{
    width: min(420px, 92vw);
    background: #fff;
    border-radius: 18px;
    padding: 22px 18px;
    box-shadow: 0 18px 60px rgba(0,0,0,0.25);
    text-align:center;
    }

    .overlayTitle{
    font-weight: 900;
    font-size: 18px;
    margin-top: 12px;
    color: #111827;
    }

    .overlaySub{
    margin-top: 6px;
    color: #6b7280;
    font-weight: 600;
    }

    /* Spinner */
    .spinner{
    width: 54px;
    height: 54px;
    margin: 4px auto 0;
    border-radius: 50%;
    border: 6px solid rgba(249,115,22,0.18);
    border-top-color: #f97316;
    animation: spin .85s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    /* Check animado */
    .checkWrap{ width: 72px; height: 72px; margin: 0 auto; }
    .checkSvg{ width: 72px; height: 72px; }
    .checkCircle{
    stroke: #22c55e;
    stroke-width: 4;
    stroke-dasharray: 151;
    stroke-dashoffset: 151;
    animation: drawCircle .45s ease forwards;
    }
    .checkMark{
    stroke: #16a34a;
    stroke-width: 5;
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: drawCheck .35s .35s ease forwards;
    }
    @keyframes drawCircle{ to{ stroke-dashoffset: 0; } }
    @keyframes drawCheck{ to{ stroke-dashoffset: 0; } }

    .successText{ color:#16a34a; }

    .overlayBtn{
    margin-top: 16px;
    width: 100%;
    padding: 12px 14px;
    border-radius: 12px;
    border: 0;
    background: #111827;
    color: #fff;
    font-weight: 800;
    cursor: pointer;
    }
    .overlayBtn:hover{ filter: brightness(1.05); }

    .hidden { display: none !important; }


</style>


</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <img class="logo"
          src="https://raw.githubusercontent.com/gisjesusmaria/web/refs/heads/main/Logos/Logo01ConFondoWide.png"
          alt="Municipalidad de Jesús María" />
        <div class="titles">
          <h1>Relevamiento a comercios - Operativo Festival 2026</h1>
          <p>Destinado a comercios fijos y puesteros</p>
        </div>
      </div>
      <div class="chip">* Campos obligatorios</div>
    </div>

    <div class="card">
      <div class="card-header">
        <div>
          <div style="font-weight:800;font-size:15px;margin-bottom:4px;">Formulario</div>
          <div style="color:var(--muted);font-size:13px;line-height:1.35;">
            Completá los datos y presioná <b>Enviar</b>. Los campos obligatorios replican el Google Form.
          </div>
        </div>
        <div class="chip">Operativo Festival 2026</div>
      </div>

      <div class="status" id="status"></div>

      <!-- <form id="f"> -->
    <form id="f" method="POST" target="hidden_iframe">

        <div class="grid">
          <!-- 1 -->
          <div class="field">
            <label>1- ¿A qué rubro pertenece su comercio? <span class="req">*</span></label>
            <select name="rubro" id="rubro" required>
                <option value="" selected disabled>Seleccionar…</option>
                <option>Almacén / Quiosco</option>
                <option>Artesanías</option>
                <option>Bebidas</option>
                <option>Gastronómico</option>
                <option>Indumentaria</option>
                <option>Talabartería</option>
                <option>Otro rubro</option>
            </select>
          </div>

          <!-- 2 -->
          <div class="field">
            <label>2- ¿De dónde son sus proveedores? <span class="req">*</span></label>
            <select name="proveedores_origen" id="proveedores_origen" required>
              <option value="" selected disabled>Seleccionar…</option>
              <option>Jesús María</option>
              <option>Colonia Caroya</option>
              <option>Sinsacate</option>
              <option>Otra localidad</option>
            </select>

            <div id="wrap_otra_loc" style="display:none;margin-top:10px;">
              <label style="margin:0 0 8px 0;font-weight:650;font-size:13.5px;">
                2.a- En caso de responder "otra localidad", ¿Cuál?
              </label>
              <input type="text" name="proveedores_otra_localidad" id="proveedores_otra_localidad"
                     placeholder="Escribí la localidad" />
              <div class="hint">Este campo no es obligatorio (igual que en el Form).</div>
            </div>
          </div>

          <!-- 3 -->
          <div class="field" style="grid-column: 1 / -1;">
            <label>3- ¿Cuáles son sus principales proveedores?</label>
            <textarea name="proveedores_principales" id="proveedores_principales"
                      placeholder="Ej.: Proveedor A, Proveedor B…"></textarea>
          </div>

          <!-- 4 -->
          <div class="field" style="grid-column: 1 / -1;">
            <label>4- ¿Cuáles son los cuatro productos que más compra? <span class="req">*</span></label>
            <textarea name="productos_top4" id="productos_top4" required
                      placeholder="Enumeralos o separalos con comas"></textarea>
          </div>

          <!-- 5 -->
          <div class="field" style="grid-column: 1 / -1;">
            <label>5- ¿Cuánto compra de cada producto aproximadamente? <span class="req">*</span></label>
            <textarea name="compra_cantidad" id="compra_cantidad" required
                      placeholder="Ej.: 20 kg, 10 cajas, 50 unidades…"></textarea>
          </div>

          <!-- 6 -->
          <div class="field">
            <label>6- ¿Alquila algún servicio local? <span class="req">*</span></label>
            <div class="inline" role="radiogroup" aria-label="Alquila servicio local">
              <label class="radio"><input type="radio" name="alquila_servicio" value="Si" required> Sí</label>
              <label class="radio"><input type="radio" name="alquila_servicio" value="No" required> No</label>
            </div>

            <!-- <div id="wrap_alquila_det" style="display:none;margin-top:10px;">
              <label style="margin:0 0 8px 0;font-weight:650;font-size:13.5px;">
                6.a- En caso de responder "Si", ¿Qué tipo de servicio alquila?
              </label>
              <input type="text" name="alquila_servicio_detalle" id="alquila_servicio_detalle"
                     placeholder="Ej.: heladeras, sonido, plomero…" />
              <div class="hint">Este campo no es obligatorio (igual que en el Form).</div>
            </div> -->

            <div id="wrap_alquila_det" style="display:none;margin-top:10px;">
            <label style="margin:0 0 8px 0;font-weight:650;font-size:13.5px;">
                6.a- En caso de responder "Si", ¿Qué tipo de servicio alquila?
            </label>

            <select name="alquila_servicio_opcion" id="alquila_servicio_opcion">
                <option value="" selected disabled>Seleccionar…</option>
                <option>Electricista</option>
                <option>Equipo de sonido</option>
                <option>Freezers</option>
                <option>Heladeras</option>
                <option>Mesas</option>
                <option>Plomero</option>
                <option>Sillas</option>
                <option>Sonidista</option>
                <option>Tablones</option>
                <option>Otro</option>
            </select>

            <div id="wrap_alquila_otro" style="display:none;margin-top:10px;">
                <label style="margin:0 0 8px 0;font-weight:650;font-size:13.5px;">
                Especifique el servicio <span class="req">*</span>
                </label>
                <input
                type="text"
                name="alquila_servicio_especificar"
                id="alquila_servicio_especificar"
                placeholder="Escriba el servicio"
                />
            </div>

            <div class="hint">Si elegís “Otro”, tenés que especificar.</div>
            </div>

          </div>

          <!-- 7 -->
          <div class="field">
            <label>7- ¿Contrata personal para que trabaje durante el Festival? <span class="req">*</span></label>
            <div class="inline" role="radiogroup" aria-label="Contrata personal">
              <label class="radio"><input type="radio" name="contrata_personal" value="Si" required> Sí</label>
              <label class="radio"><input type="radio" name="contrata_personal" value="No" required> No</label>
            </div>

            <div id="wrap_personal_origen" style="display:none;margin-top:10px;">
              <label style="margin:0 0 8px 0;font-weight:650;font-size:13.5px;">
                7.a- En caso de responder "Si", ¿De donde es el personal?
              </label>
              <select name="personal_origen" id="personal_origen">
                <option value="" selected disabled>Seleccionar…</option>
                <option>Jesús María</option>
                <option>Colonia Caroya</option>
                <option>Sinsacate</option>
                <option>Otra localidad</option>
              </select>
              <div class="hint">Este campo no es obligatorio (igual que en el Form).</div>
            </div>
          </div>

          <!-- 8 -->
          <!-- <div class="field" style="grid-column: 1 / -1;">
            <label>8- ¿Cuántas personas contrata en total durante las noches del Festival? <span class="req">*</span></label>
            <input
            type="text"
            name="personal_cantidad"
            id="personal_cantidad"
            placeholder="Ej.: 5"
            autocomplete="off"
            pattern="[0-9]*"
            inputmode="numeric"
            required
            oninput="this.value = this.value.replace(/[^0-9]/g, '')">
          </div> -->

            <!-- 8 (wrap para ocultar/mostrar) -->
            <div id="wrap_personal_cantidad" class="field" style="grid-column: 1 / -1; display:none;">
            <label>8- ¿Cuántas personas contrata en total durante las noches del Festival? <span class="req">*</span></label>

            <input
                type="text"
                name="personal_cantidad"
                id="personal_cantidad"
                placeholder="Ej.: 5"
                autocomplete="off"
                pattern="[0-9]*"
                inputmode="numeric"
                oninput="this.value = this.value.replace(/[^0-9]/g, '')">
            </div>

        </div>

        <div class="actions">
          <button type="button" class="secondary" id="btnReset">Limpiar</button>
          <button type="submit" id="btnSend">Enviar</button>
        </div>

        <div class="toast" id="toast"></div>

        <input type="hidden" name="alquila_servicio_detalle" id="alquila_servicio_detalle_hidden" value="">

      </form>
      <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

    </div>
  </div>

    <div id="submitOverlay" class="overlay hidden" aria-live="polite" aria-busy="true">
    <div class="overlayCard">

        <div id="loadingState">
        <div class="spinner" aria-hidden="true"></div>
        <div class="overlayTitle">Registrando encuesta...</div>
        <div class="overlaySub">Por favor, aguardá un momento.</div>
        </div>

        <div id="successState" class="hidden">
        <div class="checkWrap" aria-hidden="true">
            <svg class="checkSvg" viewBox="0 0 52 52">
            <circle class="checkCircle" cx="26" cy="26" r="24" fill="none"></circle>
            <path class="checkMark" fill="none" d="M14 27 L22 35 L38 19"></path>
            </svg>
        </div>
        <div class="overlayTitle successText">¡Encuesta registrada!</div>
        <div class="overlaySub">Muchas gracias ❤️</div>
        </div>

        <div id="errorState" class="hidden">
        <div class="overlayTitle" style="color:#b42318;">No se pudo registrar</div>
        <div class="overlaySub">Revisá tu conexión e intentá de nuevo.</div>
        </div>

        <button id="closeOverlayBtn" type="button" class="overlayBtn hidden">Cerrar</button>
    </div>
    </div>


  <script>
    const f = document.getElementById("f");
    const toast = document.getElementById("toast");
    const btnSend = document.getElementById("btnSend");
    const btnReset = document.getElementById("btnReset");

    const proveedores_origen = document.getElementById("proveedores_origen");
    const wrap_otra_loc = document.getElementById("wrap_otra_loc");
    const alquilaRadios = () => document.querySelector('input[name="alquila_servicio"]:checked');
    const contrataRadios = () => document.querySelector('input[name="contrata_personal"]:checked');


    const alquila_opcion = document.getElementById("alquila_servicio_opcion");
    const wrap_alquila_otro = document.getElementById("wrap_alquila_otro");
    const alquila_especificar = document.getElementById("alquila_servicio_especificar");


    const wrap_alquila_det = document.getElementById("wrap_alquila_det");
    const wrap_personal_origen = document.getElementById("wrap_personal_origen");

    const wrap_personal_cantidad = document.getElementById("wrap_personal_cantidad");
    const personal_cantidad = document.getElementById("personal_cantidad");


    // Overlay UI (spinner / success / error)
    const overlay = document.getElementById('submitOverlay');
    const loading = document.getElementById('loadingState');
    const success = document.getElementById('successState');
    const errorSt = document.getElementById('errorState');
    const closeBtn = document.getElementById('closeOverlayBtn');

    const showOverlay = () => overlay.classList.remove('hidden');
    const hideOverlay = () => overlay.classList.add('hidden');
    const setState = (state) => {
    loading.classList.toggle('hidden', state !== 'loading');
    success.classList.toggle('hidden', state !== 'success');
    errorSt.classList.toggle('hidden', state !== 'error');
    closeBtn.classList.toggle('hidden', state === 'loading');
    };

    closeBtn.addEventListener('click', hideOverlay);



    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw-wZBKeOxxosLbk8mNLSgWXzAAHg4XispyExVAWdyDZ8t5ijfpfTr1Jb7BjSMayODT/exec"; // termina en /exec

    f.action = WEB_APP_URL;

    const hiddenIframe = document.getElementById("hidden_iframe");
    const alquilaHidden = document.getElementById("alquila_servicio_detalle_hidden");

    let submitting = false;

    // hiddenIframe.addEventListener("load", () => {
    // if (!submitting) return;
    // submitting = false;

    // btnSend.disabled = false;
    // btnSend.textContent = "Enviar";
    // showToast("ok", "✅ <strong>Enviado.</strong> Gracias. El registro se guardó correctamente.");
    // });


    hiddenIframe.addEventListener("load", () => {
    if (!submitting) return;
    submitting = false;

    // Mostrar éxito
    setState('success');

    // Reset completo para nueva respuesta
    f.reset();

    // Limpiar inputs manuales por si algún navegador no lo hace perfecto
    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
    document.querySelectorAll('input[type="text"], textarea').forEach(el => el.value = "");

    // Limpiar hidden del detalle servicio
    if (alquilaHidden) alquilaHidden.value = "";

    // Volver a ocultar condicionales y limpiar required de "otro"
    toggleConditional();

    // Rehabilitar botón
    btnSend.disabled = false;
    btnSend.textContent = "Enviar";

    // Cerrar overlay luego de un ratito y volver arriba
    setTimeout(() => {
        hideOverlay();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 1600);
    });



    function showToast(type, html){
      toast.className = "toast " + (type || "");
      toast.innerHTML = html;
      toast.style.display = "block";
      toast.scrollIntoView({behavior:"smooth", block:"nearest"});
    }
    function hideToast(){ toast.style.display = "none"; }

    // function toggleConditional(){
    //   // 2.a
    //   wrap_otra_loc.style.display = (proveedores_origen.value === "Otra localidad") ? "block" : "none";


    //   // 6.a
    //   const a = alquilaRadios();
    //   wrap_alquila_det.style.display = (a && a.value === "Si") ? "block" : "none";

    //   // 7.a
    //   const c = contrataRadios();
    //   wrap_personal_origen.style.display = (c && c.value === "Si") ? "block" : "none";
    // }

    function toggleConditional(){
      // 2.a
      wrap_otra_loc.style.display = (proveedores_origen.value === "Otra localidad") ? "block" : "none";

      // 6.a (si alquila = Si, mostrar select)
      const a = alquilaRadios();
      const alquilaSi = (a && a.value === "Si");
      wrap_alquila_det.style.display = alquilaSi ? "block" : "none";

      // Si no es "Si", limpiar y no requerir nada
      if (!alquilaSi) {
        if (alquila_opcion) alquila_opcion.value = "";
        if (alquila_especificar) alquila_especificar.value = "";
        if (wrap_alquila_otro) wrap_alquila_otro.style.display = "none";
        if (alquila_especificar) alquila_especificar.required = false;
      } else {
        // Si es Si, y eligió "Otro", pedir especificación
        const isOtro = alquila_opcion && alquila_opcion.value === "Otro";
        wrap_alquila_otro.style.display = isOtro ? "block" : "none";
        alquila_especificar.required = !!isOtro;
        if (!isOtro && alquila_especificar) alquila_especificar.value = "";
      }

      // 7.a
    //   const c = contrataRadios();
    //   wrap_personal_origen.style.display = (c && c.value === "Si") ? "block" : "none";

        // 7.a + 8 (cantidad)
        const c = contrataRadios();
        const contrataSi = (c && c.value === "Si");

        // 7.a (origen) solo si contrata = Si
        wrap_personal_origen.style.display = contrataSi ? "block" : "none";

        // 8 solo si contrata = Si
        if (wrap_personal_cantidad) {
        wrap_personal_cantidad.style.display = contrataSi ? "block" : "none";
        }

        if (personal_cantidad) {
        if (contrataSi) {
            personal_cantidad.required = true;

            // opcional: si venía de "No" y quedó en 0, lo limpiamos para que cargue el valor real
            if (personal_cantidad.value === "0") personal_cantidad.value = "";
        } else {
            // Si eligió "No": oculto, NO requerido y se registra 0
            personal_cantidad.required = false;
            personal_cantidad.value = "0";
        }
        }

    }


    proveedores_origen.addEventListener("change", toggleConditional);
    document.addEventListener("change", (e)=>{
      if (e.target && (e.target.name === "alquila_servicio" || e.target.name === "contrata_personal")) {
        toggleConditional();
      }
    });

    if (alquila_opcion) {
      alquila_opcion.addEventListener("change", toggleConditional);
    }


    btnReset.addEventListener("click", ()=>{
      f.reset();
      hideToast();
      toggleConditional();
      window.scrollTo({top:0, behavior:"smooth"});
    });

    // f.addEventListener("submit", (e)=>{
    //   e.preventDefault();
    //   hideToast();

    //   // Validación HTML5
    //   if (!f.checkValidity()) {
    //     f.reportValidity();
    //     showToast("err", "<strong>Faltan campos obligatorios.</strong> Revisá los marcados con *.");
    //     return;
    //   }

    //   // Armar payload
    //   const fd = new FormData(f);
    //   const data = Object.fromEntries(fd.entries());


    //   // Construir el valor final de 6.a para enviar al backend
    //   const a = alquilaRadios();
    //   if (a && a.value === "Si") {
    //     const opcion = (data.alquila_servicio_opcion || "").trim();
    //     if (!opcion) {
    //       showToast("err", "❌ <strong>Falta completar.</strong><br>Seleccioná el tipo de servicio (pregunta 6.a).");
    //       btnSend.disabled = false;
    //       btnSend.textContent = "Enviar";
    //       return;
    //     }
    //     if (opcion === "Otro") {
    //       const esp = (data.alquila_servicio_especificar || "").trim();
    //       if (!esp) {
    //         showToast("err", "❌ <strong>Falta completar.</strong><br>Especificá el servicio (pregunta 6.a).");
    //         btnSend.disabled = false;
    //         btnSend.textContent = "Enviar";
    //         return;
    //       }
    //       data.alquila_servicio_detalle = esp;   // <-- lo que va al sheet
    //     } else {
    //       data.alquila_servicio_detalle = opcion; // <-- lo que va al sheet
    //     }
    //   } else {
    //     data.alquila_servicio_detalle = "";
    //   }

    //   // Limpiar claves auxiliares para que el servidor no reciba basura
    //   delete data.alquila_servicio_opcion;
    //   delete data.alquila_servicio_especificar;


    //   // UX
    //   btnSend.disabled = true;
    //   btnSend.textContent = "Enviando…";

    //   // Llamada a Apps Script (sin CORS, porque corre dentro del web app)
    //   google.script.run
    //     .withSuccessHandler((res)=>{
    //       btnSend.disabled = false;
    //       btnSend.textContent = "Enviar";
    //       showToast("ok", "✅ <strong>Enviado.</strong> Gracias. El registro se guardó correctamente.");
    //       // opcional: limpiar
    //       // f.reset(); toggleConditional();
    //     })
    //     .withFailureHandler((err)=>{
    //       btnSend.disabled = false;
    //       btnSend.textContent = "Enviar";
    //       const msg = (err && err.message) ? err.message : String(err);
    //       showToast("err", `❌ <strong>No se pudo guardar.</strong><br>${msg}`);
    //     })
    //     .submitForm(data);
    // });

    f.addEventListener("submit", (e)=>{
    hideToast();

    // Asegurar Q8 según Q7 antes de validar
    const c = contrataRadios();
    const contrataSi = (c && c.value === "Si");

    if (personal_cantidad) {
    if (contrataSi) {
        personal_cantidad.required = true;
    } else {
        personal_cantidad.required = false;
        personal_cantidad.value = "0";
    }
    }


    // Validación HTML5
    if (!f.checkValidity()) {
        e.preventDefault();
        f.reportValidity();
        showToast("err", "<strong>Faltan campos obligatorios.</strong> Revisá los marcados con *.");
        return;
    }

    // Resolver 6.a -> mandarlo en hidden input (alquila_servicio_detalle)
    const a = alquilaRadios();
    if (a && a.value === "Si") {
        const opcion = (alquila_opcion?.value || "").trim();
        if (!opcion) {
        e.preventDefault();
        showToast("err", "❌ <strong>Falta completar.</strong><br>Seleccioná el tipo de servicio (pregunta 6.a).");
        return;
        }
        if (opcion === "Otro") {
        const esp = (alquila_especificar?.value || "").trim();
        if (!esp) {
            e.preventDefault();
            showToast("err", "❌ <strong>Falta completar.</strong><br>Especificá el servicio (pregunta 6.a).");
            return;
        }
        alquilaHidden.value = esp;
        } else {
        alquilaHidden.value = opcion;
        }
    } else {
        alquilaHidden.value = "";
    }

    // UX
    submitting = true;
    btnSend.disabled = true;
    btnSend.textContent = "Registrando encuesta...";

    // IMPORTANTE:
    // NO usamos e.preventDefault()
    // dejamos que el form haga POST al WebApp (iframe oculto)

    showOverlay();
    setState('loading');


    setTimeout(() => {
    if (!submitting) return;
    // sigue “enviando” demasiado tiempo -> error
    setState('error');
    closeBtn.classList.remove('hidden');
    btnSend.disabled = false;
    btnSend.textContent = "Enviar";
    submitting = false;
    }, 15000);


    });


    // init
    toggleConditional();
  </script>


</body>
</html>
