name: Backup de kioscos_corr.geojson cada media hora

on:
  schedule:
    - cron: '*/30 * * * *'  # Cada 30 minutos
  workflow_dispatch:

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Crear backup forzado (siempre)
        run: |
          ORIGEN="festival2026/kioscos_corr.geojson"
          CARPETA="festival2026/backup_kioscos"
          FECHA=$(date -u +"%Y-%m-%d_%H-%M")
          BACKUP="$CARPETA/backup_kioscos_corr_${FECHA}.geojson"

          # Verificar que el archivo exista
          if [ ! -f "$ORIGEN" ]; then
            echo "ERROR: No se encontró $ORIGEN"
            ls -la festival2026/ || echo "Carpeta festival2026/ no existe"
            exit 1
          fi

          # Crear carpeta y copiar
          mkdir -p "$CARPETA"
          cp "$ORIGEN" "$BACKUP"
          echo "Backup creado: $BACKUP"

      - name: Commit y push (forzado)
        run: |
          git config --global user.name "Backup Bot"
          git config --global user.email "backup@bot.com"

          # Agregar carpeta
          git add festival2026/backup_kioscos/

          # Commit SIEMPRE (aunque sea duplicado)
          git commit -m "Backup automático kioscos_corr: $(date -u +"%Y-%m-%d %H:%M UTC")" --allow-empty

          # Push
          git push
          echo "Backup subido a GitHub"
