<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>IP and Time</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico"></link>
</head>
<body>
    <script>
        // Function to format date in GMT-3 with specified format
        function getGMTMinus3Time() {
            const now = new Date();
            const gmtMinus3Offset = -3 * 60; // GMT-3 in minutes
            const localTime = new Date(now.getTime() + (gmtMinus3Offset * 60 * 1000));
            
            const day = String(localTime.getUTCDate()).padStart(2, '0');
            const month = String(localTime.getUTCMonth() + 1).padStart(2, '0');
            const year = localTime.getUTCFullYear();
            const hours = String(localTime.getUTCHours()).padStart(2, '0');
            const minutes = String(localTime.getUTCMinutes()).padStart(2, '0');
            const seconds = String(localTime.getUTCSeconds()).padStart(2, '0');
            
            return `${day}-${month}-${year}_${hours}:${minutes}:${seconds}`;
        }

        // Check if format=text is in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const isTextFormat = urlParams.get('format') === 'text';

        // Fetch public IP and display with time
        async function fetchIPAndTime() {
            try {
                const response = await fetch('https://api.ipify.org?format=text', {
                    method: 'GET',
                    headers: { 'Accept': 'text/plain' }
                });
                const ip = await response.text();
                const time = getGMTMinus3Time();
                // Output plain text if format=text, otherwise show with label
                document.body.innerText = isTextFormat ? `${ip},${time}` : `IP and Time: ${ip},${time}`;
            } catch (error) {
                document.body.innerText = isTextFormat ? `Error,${getGMTMinus3Time()}` : `Error fetching IP: ${error.message}`;
            }
        }

        // Run when the page loads
        fetchIPAndTime();
    </script>
</body>
</html>
